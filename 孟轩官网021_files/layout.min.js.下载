function adjustFormHeight(){var t=$("#form").height(),i=$(window).height(),r=130,n;t<i-r?(n=i-r,formHeight=n,$("#form").css("height",n)):formHeight=t}function adjustFormHeightAuto(){var n=$("#form").height();$("#form").css("height","auto")}function adjustFormHeightWithParameter(n,t){if(n=Math.round(n),document.body.scrollHeight>window.innerHeight)$("#form").css("height","auto");else{var i=ys.getElementActualHeight(t);i-n>0?$("#form").css("height",formHeight+(i-n)):$("#form").css("height",formHeight)}}function adjustInputWidth(n){var f=$("#"+n).parent().width(),i,r,t,u;if(f>0){for(i=$("#"+n).parent().children(),r=0,t=0;t<i.length;t++)i[t].id!=n&&(u=0,u=i[t].tagName=="SPAN"?i[t].offsetWidth:ys.getElementActualWidthByElement(i[t]),r+=u);$("#"+n).width(Math.floor(f)-Math.ceil(r)-31)}}function search(n){var f=$(n).val(),t,i,r,u;if(ys.isNullOrEmpty(f)){searchHistoryShow();return}if(menu_list.length==0&&$(".sidebar-nav").find("li").each(function(){var n=$(this).children()[0],i,f;if(n){var r=$(n).attr("href"),t=$(n).text().trim(),u=$(n)[0].title.trim();if(ys.isNullOrEmpty(u)||(t=u),r!="#"){i=!1;for(f in menu_list)menu_list[f].Value==t&&(i=!0);i||menu_list.push({Key:r,Value:t,ValueLowerCase:t.toLowerCase()})}}}),t="",i=searchMenuLocal(f),i.length==0)t='<p class="empty mt-3">没有结果<\/p>';else for(r=0;r<i.length;r++)u=i[r],t+='<div class="matching-post">',t+='   <a href="'+u.Key+'">',t+="       <h2>"+u.Value+"<\/h2>",t+="   <\/a>",t+="<\/div>";showSearch(t)}function clearSearch(){$(".clear-button").removeClass("show");$(".results-panel").removeClass("show");$("#txtSearch").val("")}function showSearch(n){$(".clear-button").addClass("show");$(".results-panel").addClass("show");$(".results-panel").html(n)}function searchHistoryShow(){var r=$("#txtKeyword").val(),n,t,i;if(ys.isNullOrEmpty(r)){for(clearSearch(),n="",t=0;t<config_search_menu_result.length;t++)i=config_search_menu_result[t],n+='<div class="matching-post">',n+='   <a href="'+i.Key+'">',n+="       <h2>"+i.Value+"<\/h2>",n+="   <\/a>",n+="<\/div>";showSearch(n)}}function getCurrentHistory(){var n={},i=document.title,t=i.split(" - ");return t.length>1&&(n.path=window.location.pathname+window.location.search,n.name=t[0]),n}function saveHistory(){var f=ys.getConfig("config_history"),n=[],e=getCurrentHistory(),i,t,u,r;if(e.name&&n.push(e),!ys.isNullOrEmpty(f))for(i=JSON.parse(f),t=0;t<i.length;t++){if(n.length>=6)break;for(u=!1,r=0;r<n.length;r++)if(n[r].name==i[t].name){u=!0;break}u||n.push(i[t])}ys.setConfig("config_history",JSON.stringify(n))}function initHistory(){var r=ys.getConfig("config_history"),t,n,i,u,f;if(!ys.isNullOrEmpty(r)){t=getTextByLanguage("您最近使用了：");n=JSON.parse(r);for(i in n)u=n[i].path,f=n[i].name,t+="<a href='"+u+"' class='me-3' style='font-weight:normal'>"+f+"<\/a>";$("#history").html(t)}}function hideNavigate(){var n=$(".sidebar").offset().left;n>=0&&$("body").addClass("close")}function htmlspecialchars(n){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return n.replace(/[&<>"]/g,function(n){return t[n]})}function saveComment(n,t){if(!isLogined()){ys.toastError(getTextByLanguage("请先登录"));return}if(ys.isNullOrEmpty(n)){ys.toastError(getTextByLanguage("评论内容不能为空"));return}var i={};i.Url=location.pathname.toLowerCase();i.Content=ys.trim(n);i.ReplyId=t;ys.ajax({url:apiHost+"/Comment/SaveComment",type:"post",data:i,success:function(n){n.Tag==1?(ys.toastSuccess(getTextByLanguage("评论成功")),loadComment(1)):ys.toastError(n.Message)}})}function saveReply(n,t){var i=$(n).parent().prev().find("textarea").val();saveComment(i,t)}function showReply(n,t){var r=$(n).parent().parent().find(".reply"),i;r&&r.length>0?r.remove():(i="",i+='<div class="mb-3 reply">',i+='  <div class="mb-2 position-relative">',i+='\t    <textarea class="form-control no-copy" rows="4" maxlength="300" onkeyup="countCommentChars(this)"><\/textarea>',i+='\t    <div class="word-count "><span class="text-muted small-font">0 / 300<\/span><\/div>',i+="  <\/div>",i+="  <div>",i+='\t    <button type="button" class="btn btn-outline-primary" onclick="saveReply(this,\''+t+"')\"> "+getTextByLanguage("发表评论")+" <\/button>",i+="  <\/div>",i+="<\/div>",$(n).parent().parent().append(i))}function countCommentChars(n){var t=$(n).val().length,i=$(n).next().find("span");$(i).text(t+" / 300")}function getMembershipColor(n){return n===1?"membership":""}function createPagination(n,t,i){var u="";if(t>0){u+="<nav>";u+='    <ul class="pagination justify-content-center">';u+=n>1?'        <li class="page-item"><a class="cursor-pointer page-link" onclick="'+i+"("+(n-1)+')">'+getTextByLanguage("上一页")+"<\/a><\/li>":'        <li class="page-item disabled"><a class="page-link">'+getTextByLanguage("上一页")+"<\/a><\/li>";var e=7,r=0,f=Math.max(Math.min(Math.max(1,n-2),t-e+1),1);if(f>=2)if(f==2||f==3)for(r=1;r<f;r++)u+='        <li class="page-item"><a class="cursor-pointer page-link '+getActiveClass(n,r)+'" onclick="'+i+"("+r+')">'+r+"<\/a><\/li>";else u+='        <li class="page-item"><a class="cursor-pointer page-link" onclick="'+i+'(1)">1<\/a><\/li>',u+='        <li class="page-item disabled"><a class="page-link">...<\/a><\/li>';for(r=f;r<f+e&&r<=t;r++)u+='        <li class="page-item"><a class="cursor-pointer page-link '+getActiveClass(n,r)+'" onclick="'+i+"("+r+')">'+r+"<\/a><\/li>";if(r+2<t)u+='        <li class="page-item disabled"><a class="page-link">...<\/a><\/li>',u+='        <li class="page-item"><a class="cursor-pointer page-link" onclick="'+i+"("+t+')">'+t+"<\/a><\/li>";else for(;r<=t;r++)u+='        <li class="page-item"><a class="cursor-pointer page-link '+getActiveClass(n,r)+'" onclick="'+i+"("+r+')">'+r+"<\/a><\/li>";u+=n<t?'        <li class="page-item"><a class="cursor-pointer page-link" onclick="'+i+"("+(n+1)+')">'+getTextByLanguage("下一页")+"<\/a><\/li>":'        <li class="page-item disabled"><a class="page-link">'+getTextByLanguage("下一页")+"<\/a><\/li>";u+="    <\/ul>";u+="<\/nav>"}return u}function getActiveClass(n,t){return t===n?"active":""}function updateConfigLogin(n){var i=ys.getConfig("config_login"),t=JSON.parse(i);$.extend(t,n);ys.setConfig("config_login",JSON.stringify(t))}function isLogined(){var n=ys.getConfig("config_login");return n&&n.indexOf("UserName")>0?!0:!1}var formWidth=0,formHeight=0,adHeight=0,pagePadding=20,codeMirrorFirstHeight=180,commentPageIndex,commentPageSize,userInfoQueryString;$(function(){var t=parseInt($(".content").css("padding-top")),n;t>0&&(pagePadding+=t+5);n=ys.getElementActualHeight("divAd");n>0&&(adHeight=n,$(".wwads-cn").length>0&&(adHeight+=20));$(window).width()>=576&&(codeMirrorFirstHeight=0);initHistory();saveHistory();formWidth=$("#form").width();window.pageLoad&&typeof pageLoad=="function"&&window.pageLoad();window.pageLoad1&&typeof pageLoad1=="function"&&window.pageLoad1();window.loadComment&&typeof loadComment=="function"&&window.loadComment(1);addCopyButtonForTextareas();$("#txtSearch").keyup(function(){return search(this),!1})});commentPageIndex=1;commentPageSize=3;window.loadComment=function(n){isLogined()?$("#gotoLogin").hide():($("#gotoLogin").show(),localStorage.setItem("redirectAfterLogin",window.location.pathname),localStorage.setItem("redirectAfterLogin",window.location.pathname));var t={};t.Url=location.pathname.toLowerCase();ys.ajax({url:apiHost+"/NoLogin/GetCommentList?PageIndex="+n+"&PageSize="+commentPageSize,data:t,beforeSend:function(){$("#commentList").html(getTextByLanguage("正在努力加载评论中..."))},success:function(t){var i,s,u,e,h,o,c,f,r,l;if(t.Tag==1){for($("#commentTotal").html(t.Total.toString()),i="",s=0;s<t.Data.length;s++){if(u=t.Data[s],e="",ys.isNullOrEmpty(u.Content)||(e=htmlspecialchars(u.Content),e=ys.replaceAll(e,"\n","<\/br>")),i+='<div class="pt-4 pr-2 d-flex c-border text-sm leading-5">',i+='\t<div class="w-12 me-2">',i+='\t\t<span class="inline-flex items-center justify-center font-normal text-foreground select-none shrink-0 bg-secondary h-10 w-10 text-xs rounded-full relative overflow-visible">',i+='\t\t\t<img role="img" src="'+apiHost+u.Portrait+'" class="" alt="'+u.UserName+'">',i+="\t\t<\/span>",i+="\t<\/div>",i+='\t<div class="w-full text-sm leading-5">',i+='\t\t<div class="mb-2 w-full">',i+="\t\t\t<div>",i+='\t\t\t\t<span class="fw-bold me-2">'+u.UserName+"<\/span>",i+='\t\t\t\t<span class="rounded px-sm-1 py-sm-1 user-name small '+getMembershipColor(u.IsVIP)+'">'+u.Membership+"<\/span>",i+="\t\t\t<\/div>",i+="\t\t<\/div>",h="",u.ReplyCommentInfoList)for(o="",c=u.ReplyCommentInfoList.length-1;c>=0;c--)f=u.ReplyCommentInfoList[c],ys.isNullOrEmpty(f.Content)||(o=htmlspecialchars(f.Content),o=ys.replaceAll(o,"\n","<\/br>")),r="",r+='<div class="p-1 reply-bg rounded-2 border mb-2">',r+='\t<div class="mx-1">',r+=h,r+='\t    <div class="m-1">',r+='\t\t    <span class="fw-bold me-2">'+f.UserName+"<\/span>",r+='\t\t    <span class="rounded px-sm-1 py-sm-1 user-name small '+getMembershipColor(f.IsVIP)+'">'+f.Membership+"<\/span>",r+="      <\/div > ",r+='\t\t<p class="wrap mb-3">'+o+"<\/p>",r+='\t\t<div class="d-flex justify-content-between mb-2">',r+='\t\t\t<div class="text-muted small-font">'+f.BaseCreateTime+" · "+f.IPLocation+"<\/div>",r+='\t\t\t<span class="cursor-pointer" onclick="showReply(this,\''+u.Id+"')\"> "+getTextByLanguage("回复")+" <\/span>",r+="\t\t<\/div>",r+="\t<\/div>\t ",r+="<\/div>",h=r;i+=h;i+='\t\t<p class="wrap">'+e+"<\/p>";i+='\t\t<div class="d-flex justify-content-between mb-2">';i+='\t\t\t<div class="text-muted small-font">'+u.BaseCreateTime+" · "+u.IPLocation+"<\/div>";i+='\t\t\t<span class="cursor-pointer" onclick="showReply(this,\''+u.Id+"')\"> "+getTextByLanguage("回复")+" <\/span>";i+="\t\t<\/div>";i+="\t<\/div>";i+="<\/div>"}$("#commentList").html(i);commentPageIndex=n;l=createPagination(commentPageIndex,Math.ceil(t.Total/commentPageSize),nameOf(()=>loadComment));$("#commentPagination").html(l);t.Data.length==0&&($("#comment").removeClass(),$("#commentList").removeClass())}else $("#commentList").html(getTextByLanguage("评论加载失败：")+t.Message)},error:function(){$("#commentList").html('<span class="red">'+getTextByLanguage("评论加载失败了")+"<\/span>")}})};userInfoQueryString="";